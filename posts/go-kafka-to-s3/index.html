<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133320546-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-133320546-1');
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Alexandros Panagiotou">
    <meta name="description" content="This is Alexandros">
    <meta name="keywords" content="blog,devops,personal">

    <base href="https://apanagiotou.com">
    <title>
  go-kafka-to-s3. A Go Kafka consumer and S3 uploader Â· Alexandros Panagiotou
</title>

    <link rel="canonical" href="https://apanagiotou.com/posts/go-kafka-to-s3/">

    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" href="https://apanagiotou.com/css/style.min.css">

    

    

    <link rel="icon" type="image/png" href="https://apanagiotou.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://apanagiotou.com/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49.2" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://apanagiotou.com/">
      Alexandros Panagiotou
    </a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="https://apanagiotou.com/posts/">Blog</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="https://apanagiotou.com/about/">About</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="title">go-kafka-to-s3. A Go Kafka consumer and S3 uploader</h1>
      <h2 class="date">August 8, 2018</h2>

      
    </header>

    

<h1 id="go-kafka-to-s3">go-kafka-to-s3</h1>

<p>go-kafka-to-s3 is a kafka consumer written in Go. Reads messages from a topic, gathers them in batches (files) of a pre-defined size and stores them in S3. It&rsquo;s useful if you want to have your data in a persistent storage for later process.</p>

<h2 id="getting-started">Getting Started</h2>

<p>These instructions will get you a copy of the project up and running.</p>

<h3 id="installing">Installing</h3>

<p>A step by step series of examples that tell you how to get a development env running</p>

<p>First build the docker image</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">git clone https://github.com/apanagiotou/go-kafka-to-s3
cd go-kafka-to-s3
docker build -t go-kafka-to-s3 .</pre></div>
<p>The run the docker container. You need (at least) one kafka broker, an AWS key and secret and, an S3 bucket</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">docker run --rm --name go-kafka-to-s3 -it \
    -e BOOTSTRAP_SERVERS=ip:port \
    -e KAFKA_TOPIC=topic \
    -e S3_BUCKET=your-bucket-name \
    -e S3_REGION=eu-west-1 \
    -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
    -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
    go-kafka-to-s3</pre></div>
<p>There are a couple of configuration variables that you can also change. Here are the default values for them:<br />
- KAFKA_CONSUMER_GROUP=go-kafka-to-s3<br />
- S3_BUCKET_SUBPATH=your-bucket-folder
- FILE_SIZE_THRESHOLD_MB=10</p>

<p>Example:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">docker run --rm --name go-kafka-to-s3 -it \
    -e BOOTSTRAP_SERVERS=10.1.0.1:9092 \
    -e KAFKA_TOPIC=bookings \
    -e S3_BUCKET=apanagiotou-bookings \
    -e S3_BUCKET_SUBPATH=test-folder \
    -e S3_REGION=eu-west-1 \
    -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
    -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
    go-kafka-to-s3</pre></div>
<h2 id="running-the-tests">Running the tests</h2>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">go test ./...</pre></div>
<h2 id="authors">Authors</h2>

<ul>
<li><strong>Alexandros Panagiotou</strong> - <em><a href="https://apanagiotou.com">apanagiotou.com</a></em> / Twitter: <em><a href="https://twitter.com/alexapanagiotou">@alexapanagiotou</a></em></li>
</ul>

  </article>

  <br/>

  
  
</section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>DevOps Lead @ BEAT.</p>
    
     
  </section>
</footer>

    </main>

    

  </body>

</html>
